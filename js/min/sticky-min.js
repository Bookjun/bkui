define(function(t,i,s){function n(t){return this.each(function(){var i=$(this),s=i.data(o),n=$.extend({},a.DEFAULTS,i.data(),e.utils.parseOptions(i.attr("data-sticky")),"object"==typeof t&&t);s||i.data(o,s=new a(this,n)),"string"==typeof t&&s[t].call(i)})}var $=t("jquery"),e=t("./core"),o="bk.sticky",a=function(t,i){var s=this;this.options=i,this.$element=$(t),this.sticked=null,this.inited=null,this.$holder=void 0,this.$window=$(window).on("scroll."+o,e.utils.debounce($.proxy(this.checkPosition,this),10)).on("resize."+o+" orientationchange."+o,e.utils.debounce(function(){s.reset(!0,function(){s.checkPosition()})},50)).on("load."+o,$.proxy(this.checkPosition,this)),this.offset=this.$element.offset(),this.init()};a.DEFAULTS={top:0,bottom:0,animation:"",className:{sticky:"sticky",resetting:"sticky-resetting",stickyBtm:"sticky-bottom",animationRev:"animation-reverse"}},a.prototype.init=function(){var t=this.check();if(!t)return!1;var i=this.$element,s="";$.each(i.css(["marginTop","marginRight","marginBottom","marginLeft"]),function(t,i){return s+=" "+i});var n=$('<div class="bk-sticky-placeholder"></div>').css({height:"absolute"!==i.css("position")?i.outerHeight():"","float":"none"!=i.css("float")?i.css("float"):"",margin:s});return this.$holder=i.css("margin",0).wrap(n).parent(),this.inited=1,!0},a.prototype.destroy=function(){var t=this.data(o),i=t.$holder,s=t.$element,n=t.options.className,e=t.options.animation?" bk-animation-"+t.options.animation:"";if(!t.inited)return!1;s.removeClass([e,n.stickyBtm,n.animationRev,n.sticky,n.resetting].join(" "));var a=s.parent(),r=s.clone(),c="";$.each(i.css(["marginTop","marginRight","marginBottom","marginLeft"]),function(t,i){return c+=" "+i}),r.css({height:"absolute"!==s.css("position")?s.outerHeight():"","float":"none"!=s.css("float")?s.css("float"):"",margin:c}),a.after(r).empty().remove()},a.prototype.reset=function(t,i){var s=this.options,n=this.$element,o=s.animation?" bk-animation-"+s.animation:"",a=function(){n.css({position:"",top:"",width:"",left:"",margin:0}),n.removeClass([o,s.className.animationRev,s.className.sticky,s.className.resetting].join(" ")),this.animating=!1,this.sticked=!1,this.offset=n.offset(),i&&i()}.bind(this);n.addClass(s.className.resetting),!t&&s.animation&&e.support.animation?(this.animating=!0,n.removeClass(o).one(e.support.animation.end,function(){a()}).width(),n.addClass(o+" "+s.className.animationRev)):a()},a.prototype.check=function(){if(!this.$element.is(":visible"))return!1;var t=this.options.media;if(t)switch(typeof t){case"number":if(window.innerWidth<t)return!1;break;case"string":if(window.matchMedia&&!window.matchMedia(t).matches)return!1}return!0},a.prototype.checkPosition=function(){if(!this.inited){var t=this.init();if(!t)return}var i=this.options,s=this.$window.scrollTop(),n=i.top,e=i.bottom,o=this.$element,a=i.animation?" bk-animation-"+i.animation:"",r=[i.className.sticky,a].join(" ");"function"==typeof e&&(e=e(this.$element));var c=s>this.$holder.offset().top;!this.sticked&&c?o.addClass(r):this.sticked&&!c&&this.reset(),this.$holder.css({height:o.is(":visible")&&"absolute"!==o.css("position")?o.outerHeight():""}),c&&o.css({top:n,left:this.$holder.offset().left,width:this.$holder.width()}),this.sticked=c};var r=$.fn.sticky;$.fn.sticky=n,$.fn.sticky.Constructor=a,$.fn.sticky.noConflict=function(){return $.fn.sticky=r,this},$(window).on("load",function(){$("[data-sticky]").sticky()}),s.exports=a});